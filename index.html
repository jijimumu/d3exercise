<!DOCTYPE html>
<meta charset="utf-8">
<style>

    .link {
        fill: none;
        stroke: #666;
        stroke-width: 1.5px;
    }

    #licensing {
        fill: green;
    }

    .link.licensing {
        stroke: green;
    }

    .link.resolved {
        stroke-dasharray: 0,2 1;
    }

    circle {
        fill: #ccc;
        stroke: #333;
        stroke-width: 10px;
    }

    text {
        font: 10px sans-serif;
        pointer-events: none;
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
    }

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

    var items = [
        {
            node: 'Microsoft',
            target: [
                {
                    node: 'Amazon',
                    type: 'licensing'
                },
                {
                    node: 'HTC',
                    type: 'licensing'
                },
                {
                    node: 'Barnes & Noble',
                    type: 'suit'
                },
                {
                    node: 'Foxconn',
                    type: 'suit'
                },
                {
                    node: 'Inventec',
                    type: 'suit'
                },
                {
                    node: 'Motorola',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Amazon',
            target: []
        },
        {
            node: 'HTC',
            target: [
                {
                    node: 'Apple',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Samsung',
            target: [
                {
                    node: 'Apple',
                    type: 'suit'
                },
                {
                    node: 'Kodak',
                    type: 'resolved'
                }
            ]
        },
        {
            node: 'Apple',
            target: [
                {
                    node: 'HTC',
                    type: 'suit'
                },
                {
                    node: 'Nokia',
                    type: 'resolved'
                },
                {
                    node: 'Motorola',
                    type: 'suit'
                },
                {
                    node: 'Samsung',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Motorola',
            target: [
                {
                    node: 'Apple',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Nokia',
            target: [
                {
                    node: 'Apple',
                    type: 'resolved'
                },
                {
                    node: 'Qualcomm',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Kodak',
            target: [
                {
                    node: 'Apple',
                    type: 'suit'
                },
                {
                    node: 'LG',
                    type: 'resolved'
                },
                {
                    node: 'Samsung',
                    type: 'resolved'
                },
                {
                    node: 'RIM',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Oracle',
            target: [
                {
                    node: 'Google',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'LG',
            target: [
                {
                    node: 'Kodak',
                    type: 'resolved'
                }
            ]
        },
        {
            node: 'RIM',
            target: [
                {
                    node: 'Kodak',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Sony',
            target: [
                {
                    node: 'LG',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Qualcomm',
            target: [
                {
                    node: 'Nokia',
                    type: 'resolved'
                }
            ]
        },
        {
            node: 'Motorola',
            target: [
                {
                    node: 'Microsoft',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Huawei',
            target: [
                {
                    node: 'ZTE',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Ericsson',
            target: [
                {
                    node: 'ZTE',
                    type: 'suit'
                }
            ]
        },
        {
            node: 'Barnes & Noble',
            target: []
        },
        {
            node: 'Foxconn',
            target: []
        },
        {
            node: 'Google',
            target: []
        },
        {
            node: 'Inventec',
            target: []
        },
        {
            node: 'ZTE',
            target: []
        }
    ];

    var links = [
        {source: "Microsoft", target: "Amazon", type: "licensing"}
    ];

    var nodes = {};
    var nodes2 = {};

    //Compute the distinct nodes from the links.
    links.forEach(function(link) {
        //console.log(link);
        link.source = nodes[link.source] || (nodes[link.source] = {name: link.source});
        link.target = nodes[link.target] || (nodes[link.target] = {name: link.target});
    });

    var relation = [];

    items.forEach(function(item) {
        nodes2[item.node] = {name: item.node};
        for(var i=0;i<item.target.length;i++){
            var target = nodes2[item.target[i]] || (nodes2[item.target[i]] = {name: item.target[i].node});
            relation.push({
                source: nodes2[item.node],
                target: target,
                type: item.target[i].type
            });
        }
    });

//    console.log(relation);
    console.log(links);


    var keys = Object.keys(nodes);

    for(var i=0; i< keys.length; i++){
        if(typeof nodes2[keys[i]] == 'undefined'){
            console.log(keys[i]);
        }
    }


    console.log(nodes);
//    console.log(nodes2);


    var width = 1200,
            height = 1200;

    var force = d3.layout.force()
            .nodes(d3.values(nodes))
            .links(links)
            .size([width, height])
            .linkDistance(250)
            .charge(-1200)
            .on("tick", tick)
            .start();

//    console.log(force);
            //.start();
//
//
//    var svg = d3.select("body").append("svg")
//            .attr("width", width)
//            .attr("height", height);
//
//    // Per-type markers, as they don't inherit styles.
//    svg.append("defs").selectAll("marker")
//            .data(["suit", "licensing", "resolved"])
//            .enter().append("marker")
//            .attr("id", function(d) { return d; })
//            .attr("viewBox", "0 -5 10 10")
//            .attr("refX", 65)
//            .attr("refY", 0)
//            .attr("markerWidth", 6)
//            .attr("markerHeight", 6)
//            .attr("orient", "auto")
//            .append("path")
//            .attr("d", "M0,-5L10,0L0,5");
//
//    var path = svg.append("g").selectAll("path")
//            .data(force.links())
//            .enter().append("path")
//            .attr("class", function(d) { return "link " + d.type; })
//            .attr("marker-end", function(d) { return "url(#" + d.type + ")"; });
//
//    var circle = svg.append("g").selectAll("circle")
//            .data(force.nodes())
//            .enter().append("circle")
//            .attr("r", 45)
//            .call(force.drag);
//
//    var text = svg.append("g").selectAll("text")
//            .data(force.nodes())
//            .enter().append("text")
//            .attr("x", 8)
//            .attr("y", ".31em")
//            .text(function(d) { return d.name; });
//
    // Use elliptical arc path segments to doubly-encode directionality.
    function tick() {
        path.attr("d", linkArc);
        circle.attr("transform", transform);
        text.attr("transform", transform);
    }
//
//    function linkArc(d) {
//        var dx = d.target.x - d.source.x,
//                dy = d.target.y - d.source.y,
//                dr = Math.sqrt(dx * dx + dy * dy);
//
//        var startX = d.source.x + ((d.target.x - d.source.x)/6);
//        var endX = d.source.x + ((d.target.x - d.source.x)*5/6);
//        var startY = d.source.y + ((d.target.y - d.source.y)/6);
//        var endY = d.source.y + ((d.target.y - d.source.y)*5/6);
//
//
//        return "M" + d.source.x + "," + d.source.y + "L" + d.target.x + ' ' + d.target.y;
//    }
//
//
////    function linkArc(d) {
////        var dx = d.target.x - d.source.x,
////                dy = d.target.y - d.source.y,
////                dr = Math.sqrt(dx * dx + dy * dy);
////        return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,0" + d.target.x + "," + d.target.y;
////    }
//
//    function transform(d) {
//        return "translate(" + d.x + "," + d.y + ")";
//    }

</script>
